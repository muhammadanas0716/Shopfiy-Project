"use strict";(()=>{var e={};e.id=146,e.ids=[146],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4262:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>l});var a=t(9303),n=t(8716),i=t(670),o=t(7070),d=t(5285),u=t(4104),p=t(8475);async function l(e){try{let r;await (0,d.Z)();let{customer_name:t,customer_email:s,customer_phone:a,shipping_address:n,shipping_method:i="normal",items:l=[]}=await e.json()||{};if(!t||!s||!a||!n)return o.NextResponse.json({success:!1,error:"Missing required customer fields"},{status:400});if(!Array.isArray(l)||0===l.length)return o.NextResponse.json({success:!1,error:"Cart is empty"},{status:400});let c=l.map(e=>{let r=p.b[e.productId];if(!r)throw Error("Invalid product");return{productId:e.productId,variantId:String(e.variantId),qty:Number(e.qty||1),price:r.salePrice}}),m=c.reduce((e,r)=>e+r.price*r.qty,0),g="express"===i?500:350;for(let e=0;e<5&&(r=`SS${Math.floor(1e5+9e5*Math.random())}`,await u.Z.findOne({orderId:r}).lean());e++)r=null;if(!r)return o.NextResponse.json({success:!1,error:"Could not generate order ID"},{status:500});let h=await u.Z.create({orderId:r,customer_name:t,customer_email:s,customer_phone:a,shipping_address:n,shipping_method:i,items:c,subtotal:m,shippingCost:g,total:m+g,status:"placed"});return o.NextResponse.json({success:!0,orderId:h.orderId})}catch(e){return console.error("Order POST error:",e),o.NextResponse.json({success:!1,error:"Server error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"/Users/muhammadanas/Desktop/Shopfiy-Project/app/api/orders/route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:h}=c,y="/api/orders/route";function S(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},8475:(e,r,t)=>{t.d(r,{b:()=>s});let s={gt3rs:{id:"gt3rs",name:"991 GT3 RS Style SPOILER SHELF - BLACK & WHITE",regularPrice:9999,salePrice:4999,image:"https://lh3.googleusercontent.com/d/1XUpdsY9C4uQ3vSzUD7S9icEkuKWfa4qP=w1600",variants:[{id:"1",name:"Black / Red"},{id:"2",name:"Black / No Sticker"},{id:"3",name:"White / Red"},{id:"4",name:"White / No Sticker"}]},plates:{id:"plates",name:"License Plate Posters",regularPrice:1999,salePrice:1599,image:"https://lh3.googleusercontent.com/d/1_yr6vqjgU5MllWsCtgNsHkQKQn0CEJu-=w1600",variants:[{id:"6",name:"Ferrari Plate"},{id:"7",name:"Porsche Plate"},{id:"8",name:"Lambo Plate"},{id:"9",name:"Porsche 911 Plate"},{id:"10",name:"Imran Khan Plate"},{id:"11",name:"Nissan GTR Plate"}]}}},5285:(e,r,t)=>{t.d(r,{Z:()=>o});var s=t(1185),a=t.n(s);let n=process.env.MONGODB_URI;if(!n)throw Error("Missing MONGODB_URI environment variable");let i=global._mongooseCached;async function o(){return i.conn||(i.promise||(i.promise=a().connect(n,{serverApi:{version:"1",strict:!0,deprecationErrors:!0}}).then(e=>e)),i.conn=await i.promise),i.conn}i||(i=global._mongooseCached={conn:null,promise:null})},4104:(e,r,t)=>{t.d(r,{Z:()=>o});var s=t(1185),a=t.n(s);let n=new(a()).Schema({productId:{type:String,required:!0,enum:["gt3rs","plates"]},variantId:{type:String,required:!0},qty:{type:Number,required:!0,min:1},price:{type:Number,required:!0}},{_id:!1}),i=new(a()).Schema({orderId:{type:String,required:!0,unique:!0,index:!0},customer_name:{type:String,required:!0},customer_email:{type:String,required:!0},customer_phone:{type:String,required:!0},shipping_address:{type:String,required:!0},shipping_method:{type:String,enum:["normal","express"],default:"normal"},items:{type:[n],required:!0},subtotal:{type:Number,required:!0},shippingCost:{type:Number,required:!0},total:{type:Number,required:!0},status:{type:String,default:"placed"}},{timestamps:!0}),o=a().models.Order||a().model("Order",i)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972],()=>t(4262));module.exports=s})();